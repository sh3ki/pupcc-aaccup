<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    DocumentRoot /path/to/your/project/public

    # Enable mod_rewrite
    RewriteEngine On

    # Directory configuration
    <Directory /path/to/your/project/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Force HTTPS (optional)
        # RewriteCond %{HTTPS} off
        # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    </Directory>

    # Enhanced MIME type support for PDF.js
    <IfModule mod_mime.c>
        # Ensure ES modules and JavaScript files are served correctly
        AddType application/javascript .mjs
        AddType application/javascript .js
        AddType text/javascript .mjs
        AddType text/javascript .js
        AddType application/wasm .wasm
    </IfModule>

    # PDF.js worker file optimization
    <FilesMatch "\.(mjs|js|wasm)$">
        <IfModule mod_headers.c>
            Header set Access-Control-Allow-Origin "*"
            Header set Cross-Origin-Resource-Policy "cross-origin"
            Header set Cross-Origin-Embedder-Policy "require-corp"
            Header set Cache-Control "public, max-age=31536000"
            Header set Content-Type "application/javascript"
            Header set X-Content-Type-Options "nosniff"
        </IfModule>
    </FilesMatch>

    # Security headers
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    # Gzip compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
        AddOutputFilterByType DEFLATE application/wasm
    </IfModule>

    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/yourdomain_error.log
    CustomLog ${APACHE_LOG_DIR}/yourdomain_access.log combined
</VirtualHost>

# HTTPS Virtual Host (if using SSL)
<VirtualHost *:443>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    DocumentRoot /path/to/your/project/public

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /path/to/your/ssl/cert.pem
    SSLCertificateKeyFile /path/to/your/ssl/private.key
    SSLCertificateChainFile /path/to/your/ssl/chain.pem

    # Same directory and MIME type configuration as HTTP
    <Directory /path/to/your/project/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Enhanced MIME type support for PDF.js
    <IfModule mod_mime.c>
        AddType application/javascript .mjs
        AddType application/javascript .js
        AddType text/javascript .mjs
        AddType text/javascript .js
        AddType application/wasm .wasm
    </IfModule>

    # PDF.js worker file optimization
    <FilesMatch "\.(mjs|js|wasm)$">
        <IfModule mod_headers.c>
            Header set Access-Control-Allow-Origin "*"
            Header set Cross-Origin-Resource-Policy "cross-origin"
            Header set Cross-Origin-Embedder-Policy "require-corp"
            Header set Cache-Control "public, max-age=31536000"
            Header set Content-Type "application/javascript"
            Header set X-Content-Type-Options "nosniff"
        </IfModule>
    </FilesMatch>

    # Enhanced security headers for HTTPS
    <IfModule mod_headers.c>
        Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/yourdomain_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/yourdomain_ssl_access.log combined
</VirtualHost>
